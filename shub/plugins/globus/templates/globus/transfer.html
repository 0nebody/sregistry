{% extends "base/base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}

{% block css %}
{% include "style/sliders.html" %}
<link rel="stylesheet" href="{% static "css/material-table.css"%}">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<style>
.btn-sm {
  margin-top:20px !important;
}
.active {
    font-weight:400;
}
</style>
{% if 'globus' in PLUGINS_ENABLED %}
    <link rel="stylesheet" href="{% static "css/globus_auth.css"%}">
{% endif %}
{% endblock %}

{% block content %}
{% include "messages/message.html" %}

<div id="fh5co-portfolio">

<div class="row">

    <div class="col-md-12">
        <div class="card" style="padding:20px">
            <div class="header">
                <a href="{% url 'profile' %}">
                 <h3 class="title"><span style="color:#2e609b">{{ request.user.username }}:</span> </a>
                  {% if container %} transfer {{ container.name }}{% else %}endpoints {% endif %} 
                  </h3>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-3">
        <ul class="nav nav-pills nav-stacked" style="padding-left:25px">
            {% if container %}
            <li class="active"><a data-toggle="pill" id="pill-builder" style="background-color:#2e609b" href="#transfer">Transfer</a></li>
            {% endif %}
            {% for ep in endpoints %}
            <li {% if container %}{% else %}class="active"{% endif %}><a data-toggle="pill" id="pill-builder" style="color:#2e609b" href="#{{ ep.name }}">{{ ep.display_name }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <div class="col-md-1"></div>
    <div class="col-md-8">
        <div class="tab-content"> 

            {% if container %}
            <div id="transfer" class="tab-pane fade in active">

                {% if ep | length = 0 %}
                <div class="row">
                    <div class="col-md-12">
                       <p class="alert alert-info">
                            <span You don't have any shared or personal endpoints for transfer.
                        </p> 
                    </div>
                </div>
                {% endif %}
                {% for ep in endpoints %}
                <div class="row">
                    <div class="col-md-4" style="margin-top:15px">
                        <p class="alert alert-info">
                            <span class="label label-info">From</span> Singularity Hub
                        </p>
                    </div>
                    <div class="col-md-2">
                        <a class="social-button btn-lg" 
                           id="do-transfer"
                           style="margin:auto; cursor:pointer; color: #2e609b">
                           <i class="fa fa fa-long-arrow-right fa-4x"></i></a>
                    </div>
                    <div class="col-md-4" style="margin-top:15px">
                        <p class="alert alert-warning">
                            <span class="label label-info">To</span> {{ ep.display_name }}
                        </p>
                    </div>
               </div>
               <hr>
               {% endfor %}
            </div>{% endif %}
            <hr>
            {% for ep in endpoints %}
            <div id="{{ ep.name }}" style="color:#2e609b" class="tab-pane fade in {% if container %}{% else %}active{% endif %}">
                {% include "globus/_transfer_endpoints.html" %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static "js/jquery.dataTables.min.js"%}"></script>
<script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>
<script src="{% static "js/materialize.min.js"%}"></script>
<script src="{% static "js/material.datatables.js"%}"></script>
<script src="{% static "js/ace.js"%}" type="text/javascript" charset="utf-8"></script>
<script src="{% static "js/clipboard.min.js"%}"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script src="{% static "js/cookie-token.js" %}"></script>
<script>

$(document).ready(function(){

  {% if active_tab %}
    $('#pill-{{ active_tab }}').click()    
  {% endif %}

   $('.material-pagination').hide();
   $(".browser-default").change(function(){
       $('.material-pagination').hide();
   })

   //TODO: change to click to transfer endpoint
   {% if user.is_authenticated %}
        console.log('Hello {{ user.username }}!')

        $("#star").click(function(){
            do_star();
        })

        function do_star() {

            $.ajax({
                url : "{% url 'favorite' collection.id %}",
                type : "POST",

                success : function(json) {
                    if (json['status'] == "added"){
                        $("#star").removeClass('fa-star-o');
                        $("#star").addClass('fa-star');
                        console.log("<3 <3 <3");
                    } else {
                        $("#star").removeClass('fa-star');
                        $("#star").addClass('fa-star-o');
                        console.log("Nope, don't like this one anymore!")
                    }
                },
                error : function(xhr,errmsg,err) {
                    console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                }
             });
        }
    {% endif %}


})

</script>
{% endblock %}
